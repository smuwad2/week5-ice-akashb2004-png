<!DOCTYPE html>
<html>
    <head>
        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div class="bg-light text-center p-5 mb-4">
            <h2>Choose an option:</h2>
            <label for="limit">Limit:</label>
            <input id="limit" type="number" min="1" max="5" value="1" onchange="getData()">
            <select id="type" onchange="getData()">
                <option value="customers">customers</option>
                <option value="products">products</option>
                <option value="suppliers">suppliers</option>
            </select>
        </div>
        <div id="result"></div>
        <script>
                async function getData() {
                        try {
                        //issue GET request to /data
                        const response = await axios.get("/data", {
                                "params": {
                                "type": document.getElementById("type").value,
                                "limit": document.getElementById("limit").value
                                }
                        })
                        generateTable(response.data);
                        } catch (error) {
                        console.log(error);
                        }
                }

                function generateTable(dataObj) {
                        const resultDivElem = document.getElementById("result");
                        while (resultDivElem.firstChild) {
                        resultDivElem.firstChild.remove();
                        }
                        const h2Elem = document.createElement("h2");
                        h2Elem.innerText = dataObj["type"];
                        resultDivElem.appendChild(h2Elem);
                        /* <table class="table">
                                <tbody>
                                <tr>
                                        <th></th>
                                        <th></th>
                                </tr>
                                <tr>
                                        <td></td>
                                </tr>
                                </tbody>
                        </table> */
                        let tableElem = document.createElement("table");
                        tableElem.className = "table";
                        const tBodyElem = document.createElement("tbody");
                        let trElem = document.createElement("tr");
                        //retrieve and create the table heading labels
                        console.log(dataObj["records"]);
                        const tblHeadingLabels = Object.keys(dataObj["records"][0]);
                        for (let headingLabel of tblHeadingLabels) {
                        let thElem = document.createElement("th");
                        thElem.innerText = headingLabel;
                        trElem.appendChild(thElem);
                        }
                        tBodyElem.appendChild(trElem);
                        //create the table data
                        
                        for (let i=0; i< dataObj["records"].length; i++) {
                        const trElem = document.createElement("tr");
                        let elem = dataObj["records"][i];
                        for (let j=0; j<tblHeadingLabels.length; j++) {
                                const tdElem = document.createElement("td");
                                const elemVal = elem[tblHeadingLabels[j]];
                                tdElem.innerText = elemVal;
                                trElem.appendChild(tdElem);
                        }
                        tBodyElem.appendChild(trElem);
                        }
                        tableElem.appendChild(tBodyElem);
                        resultDivElem.appendChild(tableElem);
                };
            /*function getData() {
                var type = document.getElementById("type").value;
                var limit = document.getElementById("limit").value;
                var output = document.getElementById("result"); // renamed here
                axios.get("/data", { params: { type: type, limit: limit } })
                    .then(function(res) {
                        var data = res.data.records;
                        var table = "<h2>" + type + "</h2>";
                        if (data.length === 0) {
                            table += "<p>No data</p>";
                        } else {
                            table += "<table class='table table-bordered'><tr>";
                            // headers
                            for (var key in data[0]) {
                                table += "<th>" + key + "</th>";
                            }
                            table += "</tr>";
                            // rows
                            data.forEach(function(row) {
                                table += "<tr>";
                                for (var key in row) {
                                    html += "<td>" + row[key] + "</td>";
                                }
                                table += "</tr>";
                            });
                            table += "</table>";
                        }
                        output.innerHTML = table;
                    })
                    .catch(function() {
                        output.innerHTML = "<h2>" + type + "</h2><p>Error loading data</p>";
                    });
            }
        </script>
    </body>
</html>